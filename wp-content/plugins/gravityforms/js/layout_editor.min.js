!function(b){b.fn.setGroupId=function(t){return this.attr("data-groupId",t),this.each(function(){var e=l(b(this));e&&(e.layoutGroupId=t)}),this},b.fn.setGridColumnSpan=function(t){return null===t?this.css("grid-column","auto / auto"):(this.css("grid-column","span {0}".format(t)),this.each(function(){if(b(this).hasClass("spacer")){var e=b(this).prev(".gfield");(r=l(e)).layoutSpacerGridColumnSpan=t}else(r=l(b(this)))&&(r.layoutGridColumnSpan=t)})),this;var r},b.fn.getGridColumnSpan=function(){var e=parseInt(this.css("gridColumnStart").split(" ")[1]);return isNaN(e)&&void 0!==x&&(e=x),e},String.prototype.format=function(){var r=arguments;return this.replace(/{(\d+)}/g,function(e,t){return void 0!==r[t]?r[t]:e})};var i,c=b("#form_editor_fields_container"),m=b(".gform_editor"),S=b("#gform_fields"),e=b("#no-fields"),t=b("#no-fields-drop"),v=b(".editor-sidebar"),_=b(".gfield-field-action"),C=null,r=".add-buttons button",x=getComputedStyle(S[0])["grid-template-columns"].split(" ").length,w=x/4,y=null,o=!1;function n(e){e.hasClass("ui-draggable")&&e.draggable("destroy").resizable("destroy"),e.draggable({helper:"clone",zIndex:999,handle:".gfield-drag",create:function(e,t){if(!H(b(this))){var r,i=b(this).attr("id").replace("field_",""),o=!!i&&GetFieldById(i);o&&o.layoutGroupId&&!m.hasClass("gform_legacy_markup")?r=o.layoutGroupId:I(b(this),!1)||(r=I()),b(this).setGroupId(r)}},start:function(e,t){S.addClass("dragging"),c.addClass("droppable"),(C=b(this)).addClass("placeholder")},drag:function(e,t){t.helper.width(C.width()).height(C.height()).setGridColumnSpan(null),a(0,t,t.position.top,t.position.left)},stop:function(e,t){S.removeClass("dragging"),c.removeClass("droppable"),C.removeClass("placeholder"),M().removeClass("hovering"),j().data("target")&&d(C,j().data("target"),j().data("where")),j().remove(),t.helper.remove()}}).resizable({handles:"e, w",start:function(){y=null,S.addClass("resizing")},resize:function(e,t){var r,i,o,n,a,d,l,s,f,u,h=S.outerWidth()/x,g=t.element,p=g.outerWidth(),c=Math.max(w,Math.round(p/h)),m=g.getGridColumnSpan(),v=z(I(g)),_=(i=g,1===(o=(o=v).not(".spacer")).length||o.last()[0]===i[0]),C=v.filter(".spacer"),G=_&&!C.length?null:g.next();null===y&&(y=1<v.length?m+(r=G?A(G):0):x),n=c,a=w,d=y-(1<v.length&&!_?w:0),c=Math.max(a,Math.min(d,n)),b().add(t.helper).add(t.element).css("width","auto").css("left","auto").setGridColumnSpan(c),G&&(r=y-c,G.css("width","auto").setGridColumnSpan(r)),c==x||c==y?W(C):_&&!C.length&&A(v)<x&&(s=I(l=g),f=1,u=b('<div class="spacer gfield"></div>').setGroupId(s).setGridColumnSpan(f),l.after(u))},stop:function(){S.removeClass("resizing")}})}function a(e,t,s,f){var r,i,o,n,a,d,l,u,h,g,p;(M().removeClass("hovering"),r=f,i=s,o=c.offset(),n=S.offset(),a=n.top-o.top,d=n.left-o.left,l=_.outerWidth()||null,u=-a+l,h=-d+c.outerWidth()-v.outerWidth()-l,g=-a+c.outerHeight(),p=-d,u<i&&i<g&&p<r&&r<h)?s<0?j().css({top:-30,left:0,height:"4px",width:S.outerWidth()}).data({where:"top",target:M().first()}):s>S.outerHeight()?j().css({top:S.outerHeight()-14,left:0,height:"4px",width:S.outerWidth()}).data({where:"bottom",target:M().last()}):M().not(t.helper).not(this).each(function(){var e=b(this),t=e.position(),r={top:t.top,right:t.left+e.outerWidth(),bottom:t.top+e.outerHeight(),left:t.left};if(i=f,(o=s)<(n=r).bottom&&o>n.top&&i<n.right&&i>n.left){var i,o,n;e.addClass("hovering"),H(e)&&(t=(e=e.prev()).position(),a="right");var a=function(e,t,r,i,o){var n=r.left+i/2,a=r.right-i/2,d=r.top+o/5,l=r.bottom-o/5;{if(t>r.top&&t<d)return"top";if(t<r.bottom&&l<t)return"bottom";if(e>r.left&&e<n)return"left";if(e<r.right&&a<e)return"right"}return"center"}(f,s,r,e.outerWidth(),e.outerHeight()),d=z(I(e),!1).length>=x/w,l=function(e){var t,r,i,o,n;o=I(e),i=z(o),H(e)?e=(n=e).prev():H(e.next())&&!1!==i.index(e.next())&&(n=e.next());r=(t=n?n.getGridColumnSpan():null)?t:G(i)?x/(i.length+1):(t=e.getGridColumnSpan(),t/2);if(parseInt(r)<3)return!1}(e);if("left"===a||"right"===a){if(!function(e,t){if(m.hasClass("gform_legacy_markup"))return;if(e.hasClass("gpage")||e.hasClass("gsection")||e.hasClass("gform_hidden"))return;if(t.hasClass("gpage")||t.hasClass("gsection")||t.hasClass("gform_hidden")||"hidden"===t.data("type"))return;if(t.is("button")&&-1!==b.inArray(t.val().toLowerCase(),["page","section"]))return;return 1}(e,C))return;if(d||!1===l)return}switch(j().data({where:a,target:e}),a){case"left":return j().css({top:t.top,left:t.left-10,height:e.outerHeight(),width:"4px"}),!1;case"right":return j().css({top:t.top,left:t.left+e.outerWidth()+6,right:"auto",height:e.outerHeight(),width:"4px"}),!1;case"bottom":return j().css({top:t.top+e.outerHeight()+26,left:0,height:"4px",width:"100%"}),!1;case"top":return j().css({top:t.top-30,left:0,height:"4px",width:"100%"}),!1}}}):j(!1).remove()}function d(e,t,r){if(t){var i,o,n,a,d,l,s,f;if(l=I(e),n=z(d=I(t)),H(t)?t=(f=t).prev():H(t.next())&&!1!==n.index(t.next())&&(f=t.next()),s="left"===r||"right"===r,f&&s&&(i=f.getGridColumnSpan(),W(f),n=z(d)),"top"==r?t=n.first():"bottom"==r&&(t=n.last()),"top"==r||"left"==r?e.insertBefore(t):e.insertAfter(t),s)if(i?(a=e,o=i):a=G(n)?(o=x/(n.length+1),n.add(e)):(o=(i=t.getGridColumnSpan())/2,t.add(e)),parseInt(o)==o)a.setGridColumnSpan(o);else{var u=Math.floor(o),h=Math.ceil(o);e.setGridColumnSpan(u),t.setGridColumnSpan(h)}else d=I(),e.setGridColumnSpan(x);e.setGroupId(d),g(l)}}function I(e,t){var r;return void 0!==e&&(r=e.attr("data-groupId")),r||!t&&void 0!==t||(r="xxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),r}function z(e,t){return t||void 0===t?M().filter('[data-groupId="{0}"]'.format(e)).not(".ui-draggable-dragging"):M().filter('[data-groupId="{0}"]'.format(e)).not(".ui-draggable-dragging").not(".spacer")}function A(e){var t=0;return e.each(function(){t+=b(this).getGridColumnSpan()}),t}function G(e){var t=e.first().getGridColumnSpan(),r=!0;return e.each(function(){if(b(this).getGridColumnSpan()!==t)return r=!1}),r}function g(e){var t=z(e),r=x/t.length;t.setGridColumnSpan(r)}function W(e){e.setGridColumnSpan(0).remove()}function H(e){return 0<e.filter(".spacer").length}function l(e){var t=e.attr("id"),r=!(!t||-1===t.indexOf("field_"))&&String(t).replace("field_","");return!!r&&GetFieldById(r)}function s(e){return StartAddField(e,Math.max(0,S.children().index(C)))}function f(){M().removeClass("field_selected"),b(".sidebar").tabs("option","active",0),HideSettings()}function M(){return S.find(".gfield")}function j(e){e=void 0===e;var t=b("#indicator");return!t.length&&e&&(t=b('<div id="indicator"></div>'),S.append(t)),t}n(M()),b(r).on("mousedown touchstart",function(){b(this).attr("title","")}).draggable({helper:"clone",revert:function(){return!1},cancel:!1,appendTo:S,containment:"document",start:function(e,t){if(f(),c.addClass("droppable"),1==gf_vars.currentlyAddingField)return!1;t.helper.width(b(this).width()).height(b(this).height()),S.addClass("dragging"),(C=b(this).clone()).addClass("placeholder"),b(this).addClass("fieldPlaceholder")},drag:function(e,t){if(form.fields.length){var r=+t.position.top+t.helper.outerHeight()/2,i=+t.position.left+t.helper.outerWidth()/2;a(0,t,r,i)}},stop:function(e,t){b(this).removeClass("fieldPlaceholder"),c.removeClass("droppable"),S.removeClass("dragging");var r=!1;!form.fields.length&&o?(o=!1,r=s(t.helper.data("type"))):form.fields.length&&j(!1).data("target")&&(r=s(t.helper.data("type"))),r||(j(!1).remove(),C.remove(),C=null),b(this).attr("title",b(this).attr("data-description"))}}).on("click keypress",function(){C=null}),e.droppable({accept:r,activate:function(e,t){b(this).addClass("ready")},over:function(){b(this).addClass("hovering"),t.addClass("hovering")},out:function(){b(this).removeClass("hovering"),t.removeClass("hovering")},drop:function(){o=!0,b(this).removeClass("hovering"),t.removeClass("hovering")},deactivate:function(){b(this).removeClass("ready")}}),c.on("click",function(){f()}),b(document).on("gform_field_added",function(e,t,r){var i=b("#field_"+r.id);null===C?i.setGroupId(I()):(d(i,j().data("target"),j().data("where")),C.remove(),C=null),j().remove(),n(i)}),b(document).on("gform_field_deleted",function(e,t,r){i=I(b("#field_"+r))}),gform.addAction("gform_after_field_removed",function(e,t){g(i)}),gform.addAction("gform_field_duplicated",function(e,t,r,i){z(I(b("#field_"+i))).last().after(r),r.setGridColumnSpan(x).setGroupId(I()),n(r)}),gform.addAction("gform_after_refresh_field_preview",function(e){n(b("#field_"+e))}),gform.addAction("gform_before_get_field_markup",function(e,t,r){!function(e){var t='<li data-js-field-loading-placeholder><div class="dropzone__loader"><div class="dropzone__loader-item dropzone__loader-label"></div><div class="dropzone__loader-item dropzone__loader-content"></div></div></li>';void 0!==e?0===e?b("#gform_fields").prepend(t):b("#gform_fields").children().eq(e-1).after(t):b("#gform_fields").append(t);b("[data-js-field-loading-placeholder]").setGridColumnSpan(x),b("#form_editor_fields_container").addClass("dropzone-loader-visible"),d(b("[data-js-field-loading-placeholder]"),j(!1).data("target"),j(!1).data("where"))}(r)}),gform.addAction("gform_after_get_field_markup",function(e,t,r){b("#form_editor_fields_container").removeClass("dropzone-loader-visible"),b("[data-js-field-loading-placeholder]").remove()}),gform.addAction("gform_before_refresh_field_preview",function(e){jQuery("#field_"+e).addClass("loading")}),gform.addAction("gform_after_refresh_field_preview",function(e){jQuery("#field_"+e).removeClass("loading")})}(jQuery);